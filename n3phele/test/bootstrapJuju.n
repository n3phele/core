# bootstrapJuju.n
# Author: Lucas Pugens
name	   :  bootstrapJuju
description: just bootstrap juju and save a ssh_key to access bootstrap
version	   : 0.4.0
preferred  : true
public	   : true
icon	   : http://www.n3phele.com/icons/custom
parameters :
	int n	= 1 	# how many to create
	string juju_version = "0.6" # version to download of juju
input files:
	environments.yaml # Input file to configure juju
output files:
	id_rsa.pub # Output ssh public key to access environment
	id_rsa.txt # Output ssh private key to access environment
HPZone1: # HP Cloud
	$$my_vmPugens = CREATEVM --name myVM --n $$n
	
	ON $$my_vmPugens sudo apt-get -y install python-software-properties
	ON $$my_vmPugens sudo add-apt-repository -y ppa:juju/$$juju_version
	ON $$my_vmPugens sudo apt-get update -y && sudo apt-get install -y -qq juju
	ON $$my_vmPugens if [ ! -d "~/.juju/" ]; then mkdir ~/.juju/; fi
	ON $$my_vmPugens mv environments.yaml ~/.juju/environments.yaml
	ON $$my_vmPugens chmod go-rxw ~/.juju/environments.yaml
	ON $$my_vmPugens ssh-keygen -t rsa -f ~/.ssh/id_rsa -N ""
	ON $$my_vmPugens juju bootstrap
	
	ON $$my_vmPugens --produces [
		id_rsa.pub: output/id_rsa.pub,
		id_rsa.txt: output/id_rsa]
		mkdir output
		cat ~/.ssh/id_rsa > output/id_rsa
		cat ~/.ssh/id_rsa.pub > output/id_rsa.pub
